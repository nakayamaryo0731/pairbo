# Oaiko ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆæ›¸

> ä½œæˆæ—¥: 2024-12-30
> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æ‰¿èªæ¸ˆã¿

---

## æ¦‚è¦

Oaikoï¼ˆãŠã‚ã„ã“ï¼‰ã®å…±æœ‰å®¶è¨ˆç°¿æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆæ›¸ã€‚
æ”¯å‡ºè¨˜éŒ²ã€è² æ‹…é…åˆ†ã€ç²¾ç®—ã€è²·ã„ç‰©ãƒªã‚¹ãƒˆã®å„æ©Ÿèƒ½ã‚’æ”¯ãˆã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹ã€‚

---

## ç›®çš„

### ãªãœã“ã®è¨­è¨ˆãŒå¿…è¦ã‹

1. **MVPæ©Ÿèƒ½ã‚’æ­£ã—ãå®Ÿè£…ã™ã‚‹ãŸã‚ã®åœŸå°**
   - æ”¯å‡ºè¨˜éŒ²ã€è² æ‹…æ–¹æ³•ï¼ˆå‡ç­‰/å‚¾æ–œ/å…¨é¡è² æ‹…ï¼‰ã€ç²¾ç®—æ©Ÿèƒ½ã‚’æ­£ã—ãå®Ÿè£…ã™ã‚‹ã«ã¯ã€æ˜ç¢ºãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãŒå¿…è¦

2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’å‰æã¨ã—ãŸè¨­è¨ˆ**
   - Convexã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’æ´»ã‹ã™ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æœ€é©åŒ–

3. **å°†æ¥ã®æ‹¡å¼µæ€§ç¢ºä¿**
   - MVPå¤–æ©Ÿèƒ½ï¼ˆãƒ¬ã‚·ãƒ¼ãƒˆOCRã€é€šçŸ¥ç­‰ï¼‰è¿½åŠ æ™‚ã«ç ´ç¶»ã—ãªã„è¨­è¨ˆ

4. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„æ§‹é€ ã‚’å®Ÿç¾

---

## ã‚„ã‚‹ã“ã¨ï¼ˆæ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶ï¼‰

### æ©Ÿèƒ½è¦ä»¶

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»èªè¨¼
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†ï¼ˆè¡¨ç¤ºåã€ã‚¢ã‚¤ã‚³ãƒ³ï¼‰

#### 2. ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†

- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…ï¼ˆURLãƒªãƒ³ã‚¯æ–¹å¼ã€æœ‰åŠ¹æœŸé™ä»˜ããƒˆãƒ¼ã‚¯ãƒ³ï¼‰
- ãƒ¡ãƒ³ãƒãƒ¼ã®å½¹å‰²ç®¡ç†ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼/ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- ç· ã‚æ—¥è¨­å®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ25æ—¥ï¼‰

#### 3. æ”¯å‡ºè¨˜éŒ²

- æ”¯å‡ºã®ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- å¿…é ˆé …ç›®: é‡‘é¡ã€ã‚«ãƒ†ã‚´ãƒªã€æ”¯æ‰•è€…ã€æ—¥ä»˜
- ä»»æ„é …ç›®: ãƒ¡ãƒ¢
- è² æ‹…æ–¹æ³•ã®é¸æŠ:
  - å‡ç­‰åˆ†å‰²ï¼ˆäººæ•°ã§ç­‰åˆ†ã€ç«¯æ•°ã¯æ”¯æ‰•è€…è² æ‹…ï¼‰
  - å‚¾æ–œåˆ†å‰²ï¼ˆå‰²åˆæŒ‡å®šï¼‰
  - å‚¾æ–œåˆ†å‰²ï¼ˆé‡‘é¡æŒ‡å®šï¼‰
  - å…¨é¡è² æ‹…ï¼ˆ1äººãŒå…¨é¡è² æ‹…ï¼‰

#### 4. ã‚«ãƒ†ã‚´ãƒªç®¡ç†

- ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªï¼ˆé£Ÿè²»ã€æ—¥ç”¨å“ã€å…‰ç†±è²»ã€äº¤é€šè²»ã€å¨¯æ¥½ã€åŒ»ç™‚è²»ã€ãã®ä»–ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªè¿½åŠ ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ï¼‰

#### 5. ç²¾ç®—æ©Ÿèƒ½

- ç²¾ç®—æœŸé–“: ç· ã‚æ—¥ãƒ™ãƒ¼ã‚¹ï¼ˆä¾‹: 25æ—¥ç· ã‚ãªã‚‰11/26ã€œ12/25ãŒã€Œ12æœˆåˆ†ã€ï¼‰
- ç²¾ç®—é¡ã®è‡ªå‹•è¨ˆç®—ï¼ˆèª°ãŒèª°ã«ã„ãã‚‰æ‰•ã†ã‹ï¼‰
- ç²¾ç®—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆæœªç²¾ç®—/ç²¾ç®—æ¸ˆã¿ï¼‰
- ç²¾ç®—å±¥æ­´ã®è¨˜éŒ²

#### 6. è²·ã„ç‰©ãƒªã‚¹ãƒˆ

- ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ã‚°ãƒ«ãƒ¼ãƒ—å†…å…±æœ‰
- è³¼å…¥æ™‚ã®æ”¯å‡ºé€£æºï¼ˆãƒã‚§ãƒƒã‚¯ â†’ æ”¯å‡ºç™»éŒ²ï¼‰
- è³¼å…¥å±¥æ­´è¡¨ç¤º

#### 7. åˆ†æãƒ»ã‚°ãƒ©ãƒ•

- ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰
- æœˆåˆ¥æ¨ç§»ï¼ˆæŠ˜ã‚Œç·š/æ£’ã‚°ãƒ©ãƒ•ï¼‰

**é›†è¨ˆã®åŸºæº–**:

- æœˆåˆ¥ã‚°ãƒ©ãƒ•ã¯æ”¯å‡ºã® `date` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åŸºæº–ã«**æš¦æœˆ**ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
- ä¾‹: 12æœˆã®ã‚°ãƒ©ãƒ• = `date` ãŒ `2024-12-01` ã€œ `2024-12-31` ã®æ”¯å‡º
- ç²¾ç®—æœŸé–“ï¼ˆç· ã‚æ—¥ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã¯åˆ¥ã®æ¦‚å¿µã¨ã—ã¦æ‰±ã†

### éæ©Ÿèƒ½è¦ä»¶

| é …ç›®             | è¦ä»¶                                                       |
| ---------------- | ---------------------------------------------------------- |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹   | åˆæœŸãƒ­ãƒ¼ãƒ‰3ç§’ä»¥å†…ã€æ“ä½œã¯å³åº§ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆOptimistic UIï¼‰ |
| ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§     | é‡‘é¡è¨ˆç®—ã¯æ•´æ•°æ¼”ç®—ï¼ˆå††å˜ä½ï¼‰ã€ç«¯æ•°å‡¦ç†ãƒ«ãƒ¼ãƒ«ã‚’æ˜ç¢ºåŒ–       |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§   | Convexã«ã‚ˆã‚‹è‡ªå‹•åŒæœŸ                                       |
| ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ | å€‹äººåˆ©ç”¨ã€œå°è¦æ¨¡ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆ2ã€œ10äººç¨‹åº¦ï¼‰ã‚’æƒ³å®š              |

---

## ã©ã†ã‚„ã‚‹ã‹ï¼ˆå®Ÿè£…è©³ç´°ï¼‰

### æŠ€è¡“ä»•æ§˜

#### Convex ID ã«ã¤ã„ã¦

Convexã¯UUIDã§ã¯ãªã**ç‹¬è‡ªã®IDå½¢å¼**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

```typescript
// ID ã¯ ctx.db.insert() æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
const expenseId = await ctx.db.insert("expenses", { ... });
// â†’ "jd7s8k2m9n3p4q5r" ã®ã‚ˆã†ãªæ–‡å­—åˆ—

// å‹ã¯ Id<"ãƒ†ãƒ¼ãƒ–ãƒ«å"> ã§è¡¨ç¾ã•ã‚Œã‚‹
type ExpenseId = Id<"expenses">;

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ v.id("ãƒ†ãƒ¼ãƒ–ãƒ«å") ã‚’ä½¿ç”¨
args: {
  expenseId: v.id("expenses"),
}
```

**æ³¨æ„ç‚¹**:

- é–‹ç™ºè€…ãŒUUIDã‚’è‡ªåˆ†ã§ç”Ÿæˆã—ã¦IDã¨ã—ã¦ä½¿ã†ã“ã¨ã¯ã§ããªã„
- æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³ãªã©**è‡ªåˆ†ã§ç”Ÿæˆã™ã‚‹ä¸€æ„ã‚­ãƒ¼**ã«ã¯ `crypto.randomUUID()` ã‚’ä½¿ç”¨å¯èƒ½

#### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ‰±ã„

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥                  | ä¿å­˜å½¢å¼                | è¡¨ç¤º                                 |
| --------------------------- | ----------------------- | ------------------------------------ |
| æ”¯å‡ºæ—¥ï¼ˆdateï¼‰              | `YYYY-MM-DD` æ–‡å­—åˆ—     | ãã®ã¾ã¾è¡¨ç¤ºï¼ˆå¤‰æ›ãªã—ï¼‰             |
| ä½œæˆæ—¥æ™‚ï¼ˆcreatedAtï¼‰       | UTC Unix timestamp (ms) | ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å¤‰æ›ã—ã¦è¡¨ç¤º |
| ç²¾ç®—æœŸé–“ï¼ˆperiodStart/Endï¼‰ | `YYYY-MM-DD` æ–‡å­—åˆ—     | ãã®ã¾ã¾è¡¨ç¤ºï¼ˆå¤‰æ›ãªã—ï¼‰             |

**ç†ç”±**:

- `date` ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã€Œãã®æ—¥ã€ã‚’è¡¨ã™ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›ä¸è¦
- `createdAt` ã¯ã‚·ã‚¹ãƒ†ãƒ ãŒè¨˜éŒ²ã™ã‚‹æ­£ç¢ºãªæ™‚åˆ»ã®ãŸã‚ã€UTCä¿å­˜â†’ãƒ­ãƒ¼ã‚«ãƒ«è¡¨ç¤º

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©

```mermaid
erDiagram
    User ||--o{ GroupMember : "belongs to"
    User ||--o{ Expense : "pays"
    User ||--o{ ExpenseSplit : "owes"
    User ||--o{ ShoppingItem : "adds"

    Group ||--o{ GroupMember : "has"
    Group ||--o{ Expense : "has"
    Group ||--o{ Category : "has custom"
    Group ||--o{ Settlement : "has"
    Group ||--o{ ShoppingItem : "has"
    Group ||--o{ GroupInvitation : "has"

    Expense ||--o{ ExpenseSplit : "splits into"
    Expense }o--|| Category : "categorized by"

    Settlement ||--o{ SettlementPayment : "contains"

    User {
        id string PK
        clerkId string UK
        displayName string
        avatarUrl string
        createdAt number
        updatedAt number
    }

    Group {
        id string PK
        name string
        description string
        closingDay number
        createdAt number
        updatedAt number
    }

    GroupMember {
        id string PK
        groupId string FK
        userId string FK
        role string
        joinedAt number
    }

    GroupInvitation {
        id string PK
        groupId string FK
        token string UK
        createdBy string FK
        expiresAt number
        usedAt number
        usedBy string FK
        createdAt number
    }

    Category {
        id string PK
        groupId string FK
        name string
        icon string
        isPreset boolean
        sortOrder number
        createdAt number
    }

    Expense {
        id string PK
        groupId string FK
        amount number
        categoryId string FK
        paidBy string FK
        date string
        memo string
        splitMethod string
        createdBy string FK
        createdAt number
        updatedAt number
    }

    ExpenseSplit {
        id string PK
        expenseId string FK
        userId string FK
        amount number
    }

    Settlement {
        id string PK
        groupId string FK
        periodStart string
        periodEnd string
        status string
        settledAt number
        createdBy string FK
        createdAt number
    }

    SettlementPayment {
        id string PK
        settlementId string FK
        fromUserId string FK
        toUserId string FK
        amount number
        isPaid boolean
        paidAt number
    }

    ShoppingItem {
        id string PK
        groupId string FK
        name string
        addedBy string FK
        purchasedAt number
        purchasedBy string FK
        linkedExpenseId string FK
        createdAt number
    }
```

### å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è©³ç´°

#### Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰  | å‹      | èª¬æ˜                            |
| ----------- | ------- | ------------------------------- |
| id          | string  | Convexè‡ªå‹•ç”ŸæˆID                |
| clerkId     | string  | Clerkèªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆèªè¨¼ç”¨ï¼‰ |
| displayName | string  | è¡¨ç¤ºå                          |
| avatarUrl   | string? | ã‚¢ã‚¤ã‚³ãƒ³URL                     |
| createdAt   | number  | ä½œæˆæ—¥æ™‚ï¼ˆUnix timestampï¼‰      |
| updatedAt   | number  | æ›´æ–°æ—¥æ™‚ï¼ˆUnix timestampï¼‰      |

#### Groupï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰  | å‹      | èª¬æ˜                          |
| ----------- | ------- | ----------------------------- |
| id          | string  | Convexè‡ªå‹•ç”ŸæˆID              |
| name        | string  | ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆä¾‹: ã€Œæˆ‘ãŒå®¶ã€ï¼‰  |
| description | string? | èª¬æ˜æ–‡                        |
| closingDay  | number  | ç· ã‚æ—¥ï¼ˆ1ã€œ28ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ25ï¼‰ |
| createdAt   | number  | ä½œæˆæ—¥æ™‚                      |
| updatedAt   | number  | æ›´æ–°æ—¥æ™‚                      |

**å‚™è€ƒ**: ç· ã‚æ—¥ã¯28æ—¥ã¾ã§ã«åˆ¶é™ï¼ˆ29ã€œ31æ—¥ã¯æœˆã«ã‚ˆã£ã¦å­˜åœ¨ã—ãªã„ãŸã‚ï¼‰

#### GroupMemberï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹                  | èª¬æ˜             |
| ---------- | ------------------- | ---------------- |
| id         | string              | Convexè‡ªå‹•ç”ŸæˆID |
| groupId    | string              | æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ID   |
| userId     | string              | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID       |
| role       | "owner" \| "member" | å½¹å‰²             |
| joinedAt   | number              | å‚åŠ æ—¥æ™‚         |

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**:

- ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯æœ€ä½1äººã®ownerãŒå¿…è¦
- ownerã¯ä»–ãƒ¡ãƒ³ãƒãƒ¼ã®æ‹›å¾…ãƒ»å‰Šé™¤ãŒå¯èƒ½
- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆè€…ãŒè‡ªå‹•çš„ã«ownerã«ãªã‚‹

#### GroupInvitationï¼ˆã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹      | èª¬æ˜                            |
| ---------- | ------- | ------------------------------- |
| id         | string  | Convexè‡ªå‹•ç”ŸæˆID                |
| groupId    | string  | æ‹›å¾…å…ˆã‚°ãƒ«ãƒ¼ãƒ—ID                |
| token      | string  | æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆURLç”¨ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰ |
| createdBy  | string  | æ‹›å¾…ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID          |
| expiresAt  | number  | æœ‰åŠ¹æœŸé™ï¼ˆUnix timestampï¼‰      |
| usedAt     | number? | ä½¿ç”¨æ—¥æ™‚                        |
| usedBy     | string? | ä½¿ç”¨ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID              |
| createdAt  | number  | ä½œæˆæ—¥æ™‚                        |

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**:

- æœ‰åŠ¹æœŸé™ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ7æ—¥
- 1å›ä½¿ç”¨ã—ãŸã‚‰ç„¡åŠ¹åŒ–ï¼ˆå†åˆ©ç”¨ä¸å¯ï¼‰
- æ‹›å¾…URLã®å½¢å¼: `https://oaiko.vercel.app/invite/{token}`

#### Categoryï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹      | èª¬æ˜                                             |
| ---------- | ------- | ------------------------------------------------ |
| id         | string  | Convexè‡ªå‹•ç”ŸæˆID                                 |
| groupId    | string  | ã‚°ãƒ«ãƒ¼ãƒ—IDï¼ˆå¿…é ˆã€ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ã‚«ãƒ†ã‚´ãƒªã‚’æŒã¤ï¼‰ |
| name       | string  | ã‚«ãƒ†ã‚´ãƒªå                                       |
| icon       | string  | çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³                                   |
| isPreset   | boolean | ãƒ—ãƒªã‚»ãƒƒãƒˆç”±æ¥ã‹ã©ã†ã‹                           |
| sortOrder  | number  | è¡¨ç¤ºé †                                           |
| createdAt  | number  | ä½œæˆæ—¥æ™‚                                         |

**ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒª**:
| name | icon | sortOrder |
|------|------|-----------|
| é£Ÿè²» | ğŸ½ï¸ | 1 |
| æ—¥ç”¨å“ | ğŸ§´ | 2 |
| å…‰ç†±è²» | ğŸ’¡ | 3 |
| äº¤é€šè²» | ğŸšƒ | 4 |
| å¨¯æ¥½ | ğŸ® | 5 |
| åŒ»ç™‚è²» | ğŸ’Š | 6 |
| ãã®ä»– | ğŸ“¦ | 7 |

**ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªã®æ‰±ã„**:

- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆæ™‚ã«ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªã‚’DBã«ã‚³ãƒ”ãƒ¼
- å„ã‚°ãƒ«ãƒ¼ãƒ—ãŒç‹¬è‡ªã®ã‚«ãƒ†ã‚´ãƒªã‚»ãƒƒãƒˆã‚’æŒã¤ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
- `isPreset: true` ã§ãƒ—ãƒªã‚»ãƒƒãƒˆç”±æ¥ã‹ã©ã†ã‹ã‚’è­˜åˆ¥

```typescript
// convex/lib/presetCategories.ts
export const PRESET_CATEGORIES = [
  { name: "é£Ÿè²»", icon: "ğŸ½ï¸", sortOrder: 1 },
  { name: "æ—¥ç”¨å“", icon: "ğŸ§´", sortOrder: 2 },
  { name: "å…‰ç†±è²»", icon: "ğŸ’¡", sortOrder: 3 },
  { name: "äº¤é€šè²»", icon: "ğŸšƒ", sortOrder: 4 },
  { name: "å¨¯æ¥½", icon: "ğŸ®", sortOrder: 5 },
  { name: "åŒ»ç™‚è²»", icon: "ğŸ’Š", sortOrder: 6 },
  { name: "ãã®ä»–", icon: "ğŸ“¦", sortOrder: 7 },
] as const;

// ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆæ™‚ã«ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ã‚³ãƒ”ãƒ¼
async function createGroupWithPresetCategories(ctx, groupData) {
  const groupId = await ctx.db.insert("groups", groupData);

  for (const preset of PRESET_CATEGORIES) {
    await ctx.db.insert("categories", {
      groupId,
      name: preset.name,
      icon: preset.icon,
      isPreset: true,
      sortOrder: preset.sortOrder,
      createdAt: Date.now(),
    });
  }

  return groupId;
}
```

#### Expenseï¼ˆæ”¯å‡ºï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰  | å‹      | èª¬æ˜                     |
| ----------- | ------- | ------------------------ |
| id          | string  | Convexè‡ªå‹•ç”ŸæˆID         |
| groupId     | string  | ã‚°ãƒ«ãƒ¼ãƒ—ID               |
| amount      | number  | é‡‘é¡ï¼ˆå††ã€æ•´æ•°ï¼‰         |
| categoryId  | string  | ã‚«ãƒ†ã‚´ãƒªID               |
| paidBy      | string  | æ”¯æ‰•è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID       |
| date        | string  | æ”¯å‡ºæ—¥ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰ |
| memo        | string? | ãƒ¡ãƒ¢                     |
| splitMethod | string  | åˆ†å‰²æ–¹æ³•                 |
| createdBy   | string  | ç™»éŒ²è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID       |
| createdAt   | number  | ä½œæˆæ—¥æ™‚                 |
| updatedAt   | number  | æ›´æ–°æ—¥æ™‚                 |

**splitMethod ã®å€¤**:
| å€¤ | èª¬æ˜ | splits ã®æŒ‡å®š |
|----|------|--------------|
| `"equal"` | å‡ç­‰åˆ†å‰²ï¼ˆäººæ•°ã§ç­‰åˆ†ã€ç«¯æ•°ã¯æ”¯æ‰•è€…è² æ‹…ï¼‰ | ä¸è¦ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰ |
| `"ratio"` | å‚¾æ–œåˆ†å‰²ï¼ˆå‰²åˆæŒ‡å®šã€åˆè¨ˆ100%ï¼‰ | å¿…é ˆ: å„ãƒ¡ãƒ³ãƒãƒ¼ã®å‰²åˆ(%) |
| `"amount"` | å‚¾æ–œåˆ†å‰²ï¼ˆé‡‘é¡æŒ‡å®šã€åˆè¨ˆ=æ”¯å‡ºé¡ï¼‰ | å¿…é ˆ: å„ãƒ¡ãƒ³ãƒãƒ¼ã®é‡‘é¡ |
| `"full"` | å…¨é¡è² æ‹…ï¼ˆæŒ‡å®šã—ãŸ1äººãŒå…¨é¡è² æ‹…ã€ä»–ã¯0å††ï¼‰ | å¿…é ˆ: è² æ‹…è€…1äººã‚’æŒ‡å®š |

**"full" ã®ä¾‹**:

```
1000å††ã®æ”¯å‡ºã€Aã•ã‚“ãŒæ”¯æ‰•ã„ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã¯Aãƒ»Bãƒ»C
splitMethod: "full", splits: [{ userId: "B", value: 1000 }]
â†’ AãŒæ”¯æ‰•ã„ã€BãŒå…¨é¡è² æ‹…ï¼ˆAã¯Bã«1000å††è«‹æ±‚ã§ãã‚‹ï¼‰
â†’ Cã®è² æ‹…ã¯0å††
```

#### ExpenseSplitï¼ˆæ”¯å‡ºåˆ†å‰²ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹     | èª¬æ˜                 |
| ---------- | ------ | -------------------- |
| id         | string | Convexè‡ªå‹•ç”ŸæˆID     |
| expenseId  | string | æ”¯å‡ºID               |
| userId     | string | è² æ‹…è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID   |
| amount     | number | è² æ‹…é‡‘é¡ï¼ˆå††ã€æ•´æ•°ï¼‰ |

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**:

- ExpenseSplitã®åˆè¨ˆé‡‘é¡ = Expenseã®amountï¼ˆå¿…é ˆï¼‰
- å‡ç­‰åˆ†å‰²ã®ç«¯æ•°ã¯æ”¯æ‰•è€…ãŒè² æ‹…

**ç«¯æ•°å‡¦ç†ã®ä¾‹**:

```
1000å††ã‚’3äººã§å‡ç­‰åˆ†å‰²
â†’ 333 + 333 + 334 = 1000å††
â†’ æ”¯æ‰•è€…ãŒ334å††ã‚’è² æ‹…
```

#### Settlementï¼ˆç²¾ç®—ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰  | å‹                     | èª¬æ˜                         |
| ----------- | ---------------------- | ---------------------------- |
| id          | string                 | Convexè‡ªå‹•ç”ŸæˆID             |
| groupId     | string                 | ã‚°ãƒ«ãƒ¼ãƒ—ID                   |
| periodStart | string                 | ç²¾ç®—æœŸé–“é–‹å§‹æ—¥ï¼ˆYYYY-MM-DDï¼‰ |
| periodEnd   | string                 | ç²¾ç®—æœŸé–“çµ‚äº†æ—¥ï¼ˆYYYY-MM-DDï¼‰ |
| status      | "pending" \| "settled" | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                   |
| settledAt   | number?                | ç²¾ç®—å®Œäº†æ—¥æ™‚                 |
| createdBy   | string                 | ç²¾ç®—ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID       |
| createdAt   | number                 | ä½œæˆæ—¥æ™‚                     |

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**:

- ç· ã‚æ—¥ãƒ™ãƒ¼ã‚¹ã§æœŸé–“ã‚’è¨ˆç®—
- ä¾‹: ç· ã‚æ—¥25æ—¥ã€12æœˆåˆ† â†’ 11/26ã€œ12/25
- åŒã˜æœŸé–“ã®ç²¾ç®—ã¯1ã¤ã®ã¿
- ç²¾ç®—æ¸ˆã¿æœŸé–“ã®æ”¯å‡ºã¯ç·¨é›†ãƒ»å‰Šé™¤ä¸å¯

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»**:

```
pendingï¼ˆä½œæˆç›´å¾Œï¼‰
   â†“ å…¨SettlementPaymentã®isPaid=trueã«ãªã£ãŸã‚‰è‡ªå‹•é·ç§»
settledï¼ˆç²¾ç®—å®Œäº†ï¼‰
```

**ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯**:

```typescript
// æ”¯æ‰•ã„å®Œäº†æ™‚ã«ç²¾ç®—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è‡ªå‹•æ›´æ–°
async function markPaymentAsPaid(ctx, paymentId: Id<"settlementPayments">) {
  const payment = await ctx.db.get(paymentId);
  await ctx.db.patch(paymentId, { isPaid: true, paidAt: Date.now() });

  // åŒã˜ç²¾ç®—ã®å…¨æ”¯æ‰•ã„ã‚’å–å¾—
  const allPayments = await ctx.db
    .query("settlementPayments")
    .withIndex("by_settlement", (q) =>
      q.eq("settlementId", payment.settlementId),
    )
    .collect();

  // å…¨ã¦æ”¯æ‰•ã„æ¸ˆã¿ãªã‚‰ç²¾ç®—ã‚’å®Œäº†ã«
  const allPaid = allPayments.every((p) => p._id === paymentId || p.isPaid);
  if (allPaid) {
    await ctx.db.patch(payment.settlementId, {
      status: "settled",
      settledAt: Date.now(),
    });
  }
}
```

#### SettlementPaymentï¼ˆç²¾ç®—æ”¯æ‰•ã„ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰   | å‹      | èª¬æ˜                   |
| ------------ | ------- | ---------------------- |
| id           | string  | Convexè‡ªå‹•ç”ŸæˆID       |
| settlementId | string  | ç²¾ç®—ID                 |
| fromUserId   | string  | æ”¯æ‰•ã„å…ƒãƒ¦ãƒ¼ã‚¶ãƒ¼ID     |
| toUserId     | string  | æ”¯æ‰•ã„å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ID     |
| amount       | number  | æ”¯æ‰•ã„é‡‘é¡ï¼ˆå††ã€æ•´æ•°ï¼‰ |
| isPaid       | boolean | æ”¯æ‰•ã„å®Œäº†ãƒ•ãƒ©ã‚°       |
| paidAt       | number? | æ”¯æ‰•ã„å®Œäº†æ—¥æ™‚         |

#### ShoppingItemï¼ˆè²·ã„ç‰©ã‚¢ã‚¤ãƒ†ãƒ ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | å‹      | èª¬æ˜               |
| --------------- | ------- | ------------------ |
| id              | string  | Convexè‡ªå‹•ç”ŸæˆID   |
| groupId         | string  | ã‚°ãƒ«ãƒ¼ãƒ—ID         |
| name            | string  | ã‚¢ã‚¤ãƒ†ãƒ å         |
| addedBy         | string  | è¿½åŠ è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| purchasedAt     | number? | è³¼å…¥æ—¥æ™‚           |
| purchasedBy     | string? | è³¼å…¥è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| linkedExpenseId | string? | ç´ä»˜ã„ãŸæ”¯å‡ºID     |
| createdAt       | number  | ä½œæˆæ—¥æ™‚           |

### ä¸»è¦ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯

#### 1. ç²¾ç®—é¡è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```typescript
// ç²¾ç®—é¡è¨ˆç®—ã®æµã‚Œ
function calculateSettlement(
  groupId: string,
  periodStart: Date,
  periodEnd: Date,
) {
  // 1. æœŸé–“å†…ã®å…¨æ”¯å‡ºã‚’å–å¾—
  const expenses = getExpenses(groupId, periodStart, periodEnd);

  // 2. å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œæ”¯æ‰•ã£ãŸé‡‘é¡ã€ã¨ã€Œè² æ‹…ã™ã¹ãé‡‘é¡ã€ã‚’é›†è¨ˆ
  const balances = new Map<UserId, { paid: number; owed: number }>();

  for (const expense of expenses) {
    // æ”¯æ‰•è€…ã® paid ã‚’åŠ ç®—
    balances.get(expense.paidBy).paid += expense.amount;

    // å„è² æ‹…è€…ã® owed ã‚’åŠ ç®—
    for (const split of expense.splits) {
      balances.get(split.userId).owed += split.amount;
    }
  }

  // 3. å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å·®é¡ï¼ˆpaid - owedï¼‰ã‚’è¨ˆç®—
  // ãƒ—ãƒ©ã‚¹ = å—ã‘å–ã‚‹ã¹ãã€ãƒã‚¤ãƒŠã‚¹ = æ”¯æ‰•ã†ã¹ã
  const netBalances = balances.map((userId, { paid, owed }) => ({
    userId,
    net: paid - owed,
  }));

  // 4. æœ€å°é€é‡‘å›æ•°ã§ç²¾ç®—ã‚’è¨ˆç®—ï¼ˆè²ªæ¬²æ³•ï¼‰
  return minimizeTransfers(netBalances);
}
```

#### 2. ç· ã‚æ—¥ã‹ã‚‰ã®ç²¾ç®—æœŸé–“è¨ˆç®—

```typescript
function getSettlementPeriod(closingDay: number, year: number, month: number) {
  // ä¾‹: ç· ã‚æ—¥25æ—¥ã€2024å¹´12æœˆåˆ†
  // â†’ é–‹å§‹: 2024-11-26ã€çµ‚äº†: 2024-12-25

  const endDate = new Date(year, month - 1, closingDay);

  // å‰æœˆã®ç· ã‚æ—¥ç¿Œæ—¥ãŒé–‹å§‹æ—¥
  const startDate = new Date(year, month - 2, closingDay + 1);

  return { startDate, endDate };
}
```

#### 3. å‡ç­‰åˆ†å‰²ã®ç«¯æ•°å‡¦ç†

```typescript
function splitEqually(amount: number, memberIds: string[], payerId: string) {
  const count = memberIds.length;
  const base = Math.floor(amount / count);
  const remainder = amount % count;

  return memberIds.map((userId, index) => ({
    userId,
    // æ”¯æ‰•è€…ãŒç«¯æ•°ã‚’è² æ‹…
    amount: userId === payerId ? base + remainder : base,
  }));
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### æ”¯å‡ºç™»éŒ²ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant F as Frontend
    participant C as Convex
    participant DB as Database

    U->>F: æ”¯å‡ºæƒ…å ±å…¥åŠ›
    F->>F: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    F->>C: createExpense mutation
    C->>C: æ¨©é™ãƒã‚§ãƒƒã‚¯
    C->>C: è² æ‹…é¡è¨ˆç®—
    C->>DB: Expenseä¿å­˜
    C->>DB: ExpenseSplitä¿å­˜ï¼ˆè¤‡æ•°ï¼‰
    C-->>F: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    F->>F: Optimistic UIæ›´æ–°
    Note over F,DB: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã§ä»–ãƒ¡ãƒ³ãƒãƒ¼ã«ã‚‚åæ˜ 
```

#### ç²¾ç®—ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant F as Frontend
    participant C as Convex
    participant DB as Database

    U->>F: ç²¾ç®—ç”»é¢ã‚’é–‹ã
    F->>C: getSettlementPreview query
    C->>DB: æœŸé–“å†…ã®Expenseå–å¾—
    C->>C: ç²¾ç®—é¡è¨ˆç®—
    C-->>F: ç²¾ç®—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    U->>F: ç²¾ç®—ã‚’ç¢ºå®š
    F->>C: createSettlement mutation
    C->>DB: Settlementä¿å­˜
    C->>DB: SettlementPaymentä¿å­˜ï¼ˆè¤‡æ•°ï¼‰
    C-->>F: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    Note over U,F: å„ãƒ¡ãƒ³ãƒãƒ¼ã¯æ”¯æ‰•ã„å®Œäº†ã‚’å€‹åˆ¥ã«ãƒãƒ¼ã‚¯
```

### Convex ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

Convexå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŠã‚ˆã³ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ãŸè¨­è¨ˆæŒ‡é‡ã€‚

#### 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

Convexã§ã¯ä¸»ã«2ã¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ–¹å¼ãŒã‚ã‚‹:

| æ–¹å¼                      | æ¨å¥¨ç”¨é€”                         | ãƒ¡ãƒªãƒƒãƒˆ                   | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ               |
| ------------------------- | -------------------------------- | -------------------------- | ------------------------ |
| **Convexçµ„ã¿è¾¼ã¿ (`v.`)** | å¼•æ•°æ¤œè¨¼ã€ã‚¹ã‚­ãƒ¼ãƒå®šç¾©           | ã‚·ãƒ³ãƒ—ãƒ«ã€å‹æ¨è«–ãŒåŠ¹ã     | è¤‡é›‘ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸å¯ |
| **Zod**                   | è¤‡é›‘ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€httpAction | æ–‡å­—åˆ—é•·ã€ã‚«ã‚¹ã‚¿ãƒ æ¤œè¨¼å¯èƒ½ | äºŒé‡å®šç¾©ãŒå¿…è¦ãªå ´åˆã‚ã‚Š |

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–¹é‡**:

- **åŸºæœ¬ã¯Convexçµ„ã¿è¾¼ã¿ãƒãƒªãƒ‡ãƒ¼ã‚¿ (`v.`) ã‚’ä½¿ç”¨**
- Zodã¯ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§ã®ã¿ä½¿ç”¨:
  - æ–‡å­—åˆ—é•·åˆ¶é™ï¼ˆ`v.`ã§ã¯æœªã‚µãƒãƒ¼ãƒˆï¼‰
  - è¤‡é›‘ãªrefineï¼ˆè² æ‹…é…åˆ†ã®åˆè¨ˆãƒã‚§ãƒƒã‚¯ç­‰ï¼‰
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆreact-hook-formé€£æºï¼‰

```typescript
// convex/lib/validators.ts - å…±é€šãƒãƒªãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ©ç”¨
import { v } from "convex/values";

// å…±é€šãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ
export const splitMethodValidator = v.union(
  v.literal("equal"),
  v.literal("ratio"),
  v.literal("amount"),
  v.literal("full"),
);

export const memberRoleValidator = v.union(
  v.literal("owner"),
  v.literal("member"),
);

export const settlementStatusValidator = v.union(
  v.literal("pending"),
  v.literal("settled"),
);
```

#### 2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

**å†—é•·ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é¿ã‘ã‚‹**:

- `by_foo` ã¨ `by_foo_and_bar` ã¯å†—é•·ï¼ˆå¾Œè€…ã®ã¿ã§è‰¯ã„ï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ `["foo"]` â†’ å®Ÿè³ª `["foo", "_creationTime"]`
- `_creationTime` ã§ã®ä¸¦ã³æ›¿ãˆãŒå¿…è¦ãªå ´åˆã®ã¿å˜ä¸€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 

```typescript
// NG: å†—é•·
.index("by_group", ["groupId"])
.index("by_group_and_date", ["groupId", "date"])

// OK: by_group_and_date ã§ groupId ã®ã¿ã®æ¤œç´¢ã‚‚å¯èƒ½
.index("by_group_and_date", ["groupId", "date"])
// â€» groupId ã®ã¿ã§ _creationTime é †ãŒå¿…è¦ãªã‚‰ by_group ã‚‚å¿…è¦
```

**æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ**:

- `expenses`: `by_group_and_date` ã®ã¿ï¼ˆæ—¥ä»˜ç¯„å›²æ¤œç´¢ã«ä½¿ç”¨ï¼‰
- `groupMembers`: `by_group_and_user` ã®ã¿ã§è‰¯ã„ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ã‚°ãƒ«ãƒ¼ãƒ—å–å¾—ã« `by_user` ã‚‚å¿…è¦

#### 3. ã‚¯ã‚¨ãƒªæœ€é©åŒ–

**`.filter()` ã‚’é¿ã‘ã‚‹**:

- `.filter()` ã¯DBå¸¯åŸŸã‚’æ¶ˆè²»ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ã§é™¤å¤–ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å«ã‚€ï¼‰
- 1000ä»¶ä»¥ä¸Šã®å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯å¿…ãšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨
- TypeScriptã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¯ `.filter()` ã¨åŒã˜æ€§èƒ½

```typescript
// NG: filter ã‚’ä½¿ç”¨
const expenses = await ctx.db
  .query("expenses")
  .filter((q) => q.eq(q.field("groupId"), args.groupId))
  .collect();

// OK: withIndex ã‚’ä½¿ç”¨
const expenses = await ctx.db
  .query("expenses")
  .withIndex("by_group_and_date", (q) => q.eq("groupId", args.groupId))
  .collect();
```

#### 4. é–¢æ•°è¨­è¨ˆ

**ã™ã¹ã¦ã®å…¬é–‹é–¢æ•°ã«ãƒãƒªãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š**:

```typescript
// å¿…é ˆ: args ã¨ returns ã®ä¸¡æ–¹ã‚’æŒ‡å®š
export const create = mutation({
  args: {
    groupId: v.id("groups"),
    amount: v.number(),
    // ...
  },
  returns: v.id("expenses"),
  handler: async (ctx, args) => {
    // ...
  },
});
```

**å†…éƒ¨é–¢æ•°ã®æ´»ç”¨**:

```typescript
// ä»–ã®Convexé–¢æ•°ã‹ã‚‰ã®ã¿å‘¼ã³å‡ºã—å¯èƒ½
export const internal = internalMutation({
  args: { ... },
  handler: async (ctx, args) => { ... },
});
```

#### 5. èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

`convex-helpers` ã® Custom Functions ã‚’ä½¿ã„ã€èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±é€šåŒ–ã™ã‚‹ã€‚

**èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£…**:

```typescript
// convex/lib/auth.ts
import {
  customQuery,
  customMutation,
} from "convex-helpers/server/customFunctions";
import { query, mutation } from "../_generated/server";
import { Id } from "../_generated/dataModel";

// èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‹
type AuthUser = {
  _id: Id<"users">;
  clerkId: string;
  displayName: string;
  avatarUrl?: string;
};

// èªè¨¼æ¸ˆã¿ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å‹
type AuthCtx = {
  user: AuthUser;
};

// èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
const authMiddleware = {
  args: {},
  input: async (ctx, args) => {
    // 1. Clerk ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å–å¾—
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) {
      throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");
    }

    // 2. users ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    const user = await ctx.db
      .query("users")
      .withIndex("by_clerk_id", (q) => q.eq("clerkId", identity.subject))
      .unique();
    if (!user) {
      throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    }

    // 3. ctx.user ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹
    return { ctx: { ...ctx, user }, args };
  },
};

// èªè¨¼å¿…é ˆã® query / mutation
export const authQuery = customQuery(query, authMiddleware);
export const authMutation = customMutation(mutation, authMiddleware);
```

**ä½¿ç”¨ä¾‹**:

```typescript
// convex/expenses.ts
import { authMutation } from "./lib/auth";
import { v } from "convex/values";

export const create = authMutation({
  args: {
    groupId: v.id("groups"),
    amount: v.number(),
    // ...
  },
  handler: async (ctx, args) => {
    // ctx.user ã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§è¨­å®šæ¸ˆã¿ï¼‰
    const { user } = ctx;

    // ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆèªå¯ï¼‰
    const member = await ctx.db
      .query("groupMembers")
      .withIndex("by_group_and_user", (q) =>
        q.eq("groupId", args.groupId).eq("userId", user._id),
      )
      .unique();
    if (!member) {
      throw new Error("ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“");
    }

    // æœ¬æ¥ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    return await ctx.db.insert("expenses", {
      ...args,
      createdBy: user._id,
      createdAt: Date.now(),
      updatedAt: Date.now(),
    });
  },
});
```

**é–¢æ•°ã®ä½¿ã„åˆ†ã‘**:
| é–¢æ•° | ç”¨é€” | ä¾‹ |
|------|------|-----|
| `query` / `mutation` | èªè¨¼ä¸è¦ | æ‹›å¾…ãƒªãƒ³ã‚¯ã®æ¤œè¨¼ |
| `authQuery` / `authMutation` | èªè¨¼å¿…é ˆ | æ”¯å‡ºç™»éŒ²ã€ã‚°ãƒ«ãƒ¼ãƒ—æ“ä½œ |
| `internalQuery` / `internalMutation` | å†…éƒ¨å°‚ç”¨ | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‡¦ç† |

### Zod ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»è¤‡é›‘ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆreact-hook-formï¼‰ã‚„è¤‡é›‘ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«Zodã‚’ä½¿ç”¨ã™ã‚‹ã€‚

```typescript
// convex/lib/schemas.ts
import { z } from "zod";

// ========================================
// å…±é€šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
// ========================================

/** æ—¥ä»˜æ–‡å­—åˆ—ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰ */
export const dateStringSchema = z
  .string()
  .regex(/^\d{4}-\d{2}-\d{2}$/, "æ—¥ä»˜ã¯YYYY-MM-DDå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„");

/** æ­£ã®æ•´æ•°ï¼ˆé‡‘é¡ç”¨ï¼‰ */
export const positiveIntSchema = z
  .number()
  .int("æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
  .positive("1ä»¥ä¸Šã®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

/** ç· ã‚æ—¥ï¼ˆ1ã€œ28ï¼‰ */
export const closingDaySchema = z
  .number()
  .int()
  .min(1, "ç· ã‚æ—¥ã¯1ã€œ28ã®é–“ã§è¨­å®šã—ã¦ãã ã•ã„")
  .max(28, "ç· ã‚æ—¥ã¯1ã€œ28ã®é–“ã§è¨­å®šã—ã¦ãã ã•ã„");

// ========================================
// Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
// ========================================

export const userSchema = z.object({
  clerkId: z.string().min(1, "Clerk IDã¯å¿…é ˆã§ã™"),
  displayName: z
    .string()
    .min(1, "è¡¨ç¤ºåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(50, "è¡¨ç¤ºåã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  avatarUrl: z.string().url("æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„").optional(),
});

export const createUserInputSchema = userSchema;

export const updateUserInputSchema = userSchema
  .partial()
  .omit({ clerkId: true });

// ========================================
// Groupï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
// ========================================

export const groupSchema = z.object({
  name: z
    .string()
    .min(1, "ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(50, "ã‚°ãƒ«ãƒ¼ãƒ—åã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  description: z
    .string()
    .max(200, "èª¬æ˜ã¯200æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .optional(),
  closingDay: closingDaySchema.default(25),
});

export const createGroupInputSchema = groupSchema;

export const updateGroupInputSchema = groupSchema.partial();

// ========================================
// GroupMemberï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
// ========================================

export const memberRoleSchema = z.enum(["owner", "member"]);

export type MemberRole = z.infer<typeof memberRoleSchema>;

// ========================================
// GroupInvitationï¼ˆã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…ï¼‰
// ========================================

export const createInvitationInputSchema = z.object({
  /** æœ‰åŠ¹æœŸé™ï¼ˆæ—¥æ•°ï¼‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ7æ—¥ */
  expiresInDays: z
    .number()
    .int()
    .min(1, "æœ‰åŠ¹æœŸé™ã¯1æ—¥ä»¥ä¸Šã«è¨­å®šã—ã¦ãã ã•ã„")
    .max(30, "æœ‰åŠ¹æœŸé™ã¯30æ—¥ä»¥å†…ã«è¨­å®šã—ã¦ãã ã•ã„")
    .default(7),
});

// ========================================
// Categoryï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰
// ========================================

export const categorySchema = z.object({
  name: z
    .string()
    .min(1, "ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(30, "ã‚«ãƒ†ã‚´ãƒªåã¯30æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  icon: z
    .string()
    .min(1, "ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„")
    .max(10, "ã‚¢ã‚¤ã‚³ãƒ³ã¯10æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  sortOrder: z.number().int().min(0).default(0),
});

export const createCategoryInputSchema = categorySchema;

// ========================================
// Expenseï¼ˆæ”¯å‡ºï¼‰
// ========================================

export const splitMethodSchema = z.enum(["equal", "ratio", "amount", "full"]);

export type SplitMethod = z.infer<typeof splitMethodSchema>;

/** è² æ‹…é…åˆ†ã®å…¥åŠ›ã‚¹ã‚­ãƒ¼ãƒï¼ˆratio/amount/fullç”¨ï¼‰ */
export const splitDetailSchema = z.object({
  userId: z.string(), // Convex IDã¯ zid() ã§æ¤œè¨¼
  /** ratio: å‰²åˆ(%), amount: é‡‘é¡(å††), full: ä¸è¦ */
  value: z.number().optional(),
});

export const expenseSchema = z.object({
  amount: positiveIntSchema.max(
    100_000_000,
    "é‡‘é¡ã¯1å„„å††ä»¥ä¸‹ã§å…¥åŠ›ã—ã¦ãã ã•ã„",
  ),
  categoryId: z.string(), // Convex IDã¯ zid() ã§æ¤œè¨¼
  paidBy: z.string(), // Convex IDã¯ zid() ã§æ¤œè¨¼
  date: dateStringSchema,
  memo: z.string().max(500, "ãƒ¡ãƒ¢ã¯500æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„").optional(),
  splitMethod: splitMethodSchema,
  /** splitMethodãŒratio/amount/fullã®å ´åˆã«å¿…è¦ */
  splits: z.array(splitDetailSchema).optional(),
});

export const createExpenseInputSchema = expenseSchema.refine(
  (data) => {
    // equalä»¥å¤–ã¯ splits ãŒå¿…è¦
    if (
      data.splitMethod !== "equal" &&
      (!data.splits || data.splits.length === 0)
    ) {
      return false;
    }
    // ratioã®å ´åˆã€åˆè¨ˆãŒ100%ã§ã‚ã‚‹ã“ã¨
    if (data.splitMethod === "ratio") {
      const total =
        data.splits?.reduce((sum, s) => sum + (s.value ?? 0), 0) ?? 0;
      return total === 100;
    }
    // amountã®å ´åˆã€åˆè¨ˆãŒamountã¨ä¸€è‡´ã™ã‚‹ã“ã¨
    if (data.splitMethod === "amount") {
      const total =
        data.splits?.reduce((sum, s) => sum + (s.value ?? 0), 0) ?? 0;
      return total === data.amount;
    }
    // fullã®å ´åˆã€splitsã«1äººã ã‘æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
    if (data.splitMethod === "full") {
      return data.splits?.length === 1;
    }
    return true;
  },
  {
    message: "è² æ‹…é…åˆ†ã®è¨­å®šãŒä¸æ­£ã§ã™",
    path: ["splits"],
  },
);

export const updateExpenseInputSchema = expenseSchema.partial();

// ========================================
// Settlementï¼ˆç²¾ç®—ï¼‰
// ========================================

export const settlementStatusSchema = z.enum(["pending", "settled"]);

export type SettlementStatus = z.infer<typeof settlementStatusSchema>;

export const createSettlementInputSchema = z.object({
  /** ç²¾ç®—å¯¾è±¡ã®å¹´æœˆï¼ˆä¾‹: 2024-12 â†’ 12æœˆåˆ†ã‚’ç²¾ç®—ï¼‰ */
  targetMonth: z
    .string()
    .regex(/^\d{4}-\d{2}$/, "å¹´æœˆã¯YYYY-MMå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
});

// ========================================
// SettlementPaymentï¼ˆç²¾ç®—æ”¯æ‰•ã„ï¼‰
// ========================================

export const markPaymentPaidInputSchema = z.object({
  paymentId: z.string(),
});

// ========================================
// ShoppingItemï¼ˆè²·ã„ç‰©ã‚¢ã‚¤ãƒ†ãƒ ï¼‰
// ========================================

export const shoppingItemSchema = z.object({
  name: z
    .string()
    .min(1, "ã‚¢ã‚¤ãƒ†ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "ã‚¢ã‚¤ãƒ†ãƒ åã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
});

export const createShoppingItemInputSchema = shoppingItemSchema;

export const purchaseShoppingItemInputSchema = z.object({
  itemIds: z.array(z.string()).min(1, "è³¼å…¥ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„"),
  /** æ”¯å‡ºç™»éŒ²ã™ã‚‹å ´åˆã®æƒ…å ± */
  expense: z
    .object({
      amount: positiveIntSchema,
      categoryId: z.string(),
      splitMethod: splitMethodSchema,
      splits: z.array(splitDetailSchema).optional(),
    })
    .optional(),
});
```

### Convex é–¢æ•°ã§ã®Zodåˆ©ç”¨ä¾‹

```typescript
// convex/expenses.ts
import { zCustomMutation, zCustomQuery } from "convex-helpers/server/zod";
import { zid } from "convex-helpers/server/zod";
import { mutation, query } from "./_generated/server";
import { createExpenseInputSchema } from "./lib/schemas";

// Zodå¯¾å¿œã®mutation/queryã‚’ä½œæˆ
const zMutation = zCustomMutation(mutation, {
  /* middleware options */
});
const zQuery = zCustomQuery(query, {
  /* middleware options */
});

export const create = zMutation({
  args: {
    groupId: zid("groups"),
    ...createExpenseInputSchema.shape,
  },
  handler: async (ctx, args) => {
    // args ã¯æ—¢ã«Zodã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿
    const {
      groupId,
      amount,
      categoryId,
      paidBy,
      date,
      memo,
      splitMethod,
      splits,
    } = args;

    // 1. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const member = await ctx.db
      .query("groupMembers")
      .withIndex("by_group_and_user", (q) =>
        q.eq("groupId", groupId).eq("userId", ctx.user._id),
      )
      .unique();
    if (!member) {
      throw new Error("ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“");
    }

    // 2. æ”¯å‡ºã‚’ä¿å­˜
    const now = Date.now();
    const expenseId = await ctx.db.insert("expenses", {
      groupId,
      amount,
      categoryId,
      paidBy,
      date,
      memo,
      splitMethod,
      createdBy: ctx.user._id,
      createdAt: now,
      updatedAt: now,
    });

    // 3. ExpenseSplit ã‚’ä¿å­˜
    const calculatedSplits = calculateSplits(
      amount,
      splitMethod,
      splits,
      members,
    );
    for (const split of calculatedSplits) {
      await ctx.db.insert("expenseSplits", {
        expenseId,
        userId: split.userId,
        amount: split.amount,
      });
    }

    return expenseId;
  },
});

export const listByGroup = zQuery({
  args: {
    groupId: zid("groups"),
    startDate: dateStringSchema.optional(),
    endDate: dateStringSchema.optional(),
  },
  handler: async (ctx, args) => {
    // ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆby_group_and_date ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ï¼‰
    let query = ctx.db.query("expenses").withIndex("by_group_and_date", (q) => {
      let q2 = q.eq("groupId", args.groupId);
      // æ—¥ä»˜ç¯„å›²ãŒã‚ã‚‹å ´åˆã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§çµã‚Šè¾¼ã¿
      if (args.startDate) q2 = q2.gte("date", args.startDate);
      if (args.endDate) q2 = q2.lte("date", args.endDate);
      return q2;
    });

    return await query.collect();
  },
});
```

### Convex ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼‰

ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã„ã€å†—é•·ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤ã—ãŸæœ€é©åŒ–ç‰ˆã€‚

```typescript
// convex/schema.ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";
import {
  splitMethodValidator,
  memberRoleValidator,
  settlementStatusValidator,
} from "./lib/validators";

export default defineSchema({
  // ========================================
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼
  // ========================================
  users: defineTable({
    clerkId: v.string(),
    displayName: v.string(),
    avatarUrl: v.optional(v.string()),
    createdAt: v.number(),
    updatedAt: v.number(),
  }).index("by_clerk_id", ["clerkId"]),
  // ç”¨é€”: Clerkèªè¨¼å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—

  // ========================================
  // ã‚°ãƒ«ãƒ¼ãƒ—
  // ========================================
  groups: defineTable({
    name: v.string(),
    description: v.optional(v.string()),
    closingDay: v.number(), // 1-28
    createdAt: v.number(),
    updatedAt: v.number(),
  }),
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸è¦: IDã§ç›´æ¥å–å¾—ã€ä¸€è¦§ã¯groupMembersã‹ã‚‰

  // ========================================
  // ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼
  // ========================================
  groupMembers: defineTable({
    groupId: v.id("groups"),
    userId: v.id("users"),
    role: memberRoleValidator,
    joinedAt: v.number(),
  })
    .index("by_user", ["userId"])
    // ç”¨é€”: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§å–å¾—
    .index("by_group_and_user", ["groupId", "userId"]),
  // ç”¨é€”: æ¨©é™ãƒã‚§ãƒƒã‚¯ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ï¼ˆgroupIdã®ã¿ã§ã‚‚ä½¿ç”¨å¯ï¼‰

  // ========================================
  // ã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…
  // ========================================
  groupInvitations: defineTable({
    groupId: v.id("groups"),
    token: v.string(),
    createdBy: v.id("users"),
    expiresAt: v.number(),
    usedAt: v.optional(v.number()),
    usedBy: v.optional(v.id("users")),
    createdAt: v.number(),
  }).index("by_token", ["token"]),
  // ç”¨é€”: ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰æ‹›å¾…æƒ…å ±å–å¾—
  // by_group ã¯ä¸è¦: æ‹›å¾…ä¸€è¦§è¡¨ç¤ºã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯MVPã§ã¯ä¸è¦

  // ========================================
  // ã‚«ãƒ†ã‚´ãƒª
  // ========================================
  categories: defineTable({
    groupId: v.id("groups"), // å¿…é ˆï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆæ™‚ã«ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ã‚³ãƒ”ãƒ¼ï¼‰
    name: v.string(),
    icon: v.string(),
    isPreset: v.boolean(), // ãƒ—ãƒªã‚»ãƒƒãƒˆç”±æ¥ã‹ã©ã†ã‹
    sortOrder: v.number(),
    createdAt: v.number(),
  }).index("by_group", ["groupId"]),
  // ç”¨é€”: ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚«ãƒ†ã‚´ãƒªä¸€è¦§

  // ========================================
  // æ”¯å‡º
  // ========================================
  expenses: defineTable({
    groupId: v.id("groups"),
    amount: v.number(),
    categoryId: v.id("categories"),
    paidBy: v.id("users"),
    date: v.string(), // YYYY-MM-DD
    memo: v.optional(v.string()),
    splitMethod: splitMethodValidator,
    createdBy: v.id("users"),
    createdAt: v.number(),
    updatedAt: v.number(),
  }).index("by_group_and_date", ["groupId", "date"]),
  // ç”¨é€”: ã‚°ãƒ«ãƒ¼ãƒ—ã®æ”¯å‡ºä¸€è¦§ï¼ˆæ—¥ä»˜ç¯„å›²æ¤œç´¢ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ã§ã‚‚ä½¿ç”¨å¯ï¼‰
  // by_group å˜ç‹¬ã¯ä¸è¦ï¼ˆby_group_and_date ã§ä»£ç”¨å¯èƒ½ï¼‰

  // ========================================
  // æ”¯å‡ºåˆ†å‰²
  // ========================================
  expenseSplits: defineTable({
    expenseId: v.id("expenses"),
    userId: v.id("users"),
    amount: v.number(),
  }).index("by_expense", ["expenseId"]),
  // ç”¨é€”: æ”¯å‡ºã®è² æ‹…é…åˆ†å–å¾—
  // by_user ã¯ç²¾ç®—è¨ˆç®—æ™‚ã«å¿…è¦ã ãŒã€expensesçµŒç”±ã§å–å¾—ã™ã‚‹è¨­è¨ˆã®ãŸã‚ä¸è¦

  // ========================================
  // ç²¾ç®—
  // ========================================
  settlements: defineTable({
    groupId: v.id("groups"),
    periodStart: v.string(), // YYYY-MM-DD
    periodEnd: v.string(), // YYYY-MM-DD
    status: settlementStatusValidator,
    settledAt: v.optional(v.number()),
    createdBy: v.id("users"),
    createdAt: v.number(),
  }).index("by_group_and_period", ["groupId", "periodStart"]),
  // ç”¨é€”: ã‚°ãƒ«ãƒ¼ãƒ—ã®ç²¾ç®—å±¥æ­´ã€æœŸé–“é‡è¤‡ãƒã‚§ãƒƒã‚¯
  // periodEnd ã¯ä¸è¦ï¼ˆperiodStart ã§ååˆ†ï¼‰

  // ========================================
  // ç²¾ç®—æ”¯æ‰•ã„
  // ========================================
  settlementPayments: defineTable({
    settlementId: v.id("settlements"),
    fromUserId: v.id("users"),
    toUserId: v.id("users"),
    amount: v.number(),
    isPaid: v.boolean(),
    paidAt: v.optional(v.number()),
  }).index("by_settlement", ["settlementId"]),
  // ç”¨é€”: ç²¾ç®—ã®æ”¯æ‰•ã„è©³ç´°å–å¾—

  // ========================================
  // è²·ã„ç‰©ãƒªã‚¹ãƒˆ
  // ========================================
  shoppingItems: defineTable({
    groupId: v.id("groups"),
    name: v.string(),
    addedBy: v.id("users"),
    purchasedAt: v.optional(v.number()),
    purchasedBy: v.optional(v.id("users")),
    linkedExpenseId: v.optional(v.id("expenses")),
    createdAt: v.number(),
  }).index("by_group_and_purchased", ["groupId", "purchasedAt"]),
  // ç”¨é€”: ã‚°ãƒ«ãƒ¼ãƒ—ã®è²·ã„ç‰©ãƒªã‚¹ãƒˆï¼ˆæœªè³¼å…¥: purchasedAt=nullã€å±¥æ­´: purchasedAt!=nullï¼‰
});
```

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆã®åˆ¤æ–­åŸºæº–**:
| ãƒ†ãƒ¼ãƒ–ãƒ« | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | ç”¨é€” | å‚™è€ƒ |
|----------|--------------|------|------|
| users | by_clerk_id | èªè¨¼å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾— | å¿…é ˆ |
| groupMembers | by_user | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—å–å¾— | å¿…é ˆ |
| groupMembers | by_group_and_user | æ¨©é™ãƒã‚§ãƒƒã‚¯ã€ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ | groupIdã®ã¿ã§ã‚‚ä½¿ç”¨ |
| groupInvitations | by_token | ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰æ‹›å¾…å–å¾— | å¿…é ˆ |
| categories | by_group | ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ | å¿…é ˆ |
| expenses | by_group_and_date | æ”¯å‡ºä¸€è¦§ã€æœŸé–“æ¤œç´¢ | groupIdã®ã¿ã§ã‚‚ä½¿ç”¨ |
| expenseSplits | by_expense | æ”¯å‡ºã®è² æ‹…é…åˆ†å–å¾— | å¿…é ˆ |
| settlements | by_group_and_period | ç²¾ç®—å±¥æ­´ã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ | å¿…é ˆ |
| settlementPayments | by_settlement | æ”¯æ‰•ã„è©³ç´°å–å¾— | å¿…é ˆ |
| shoppingItems | by_group_and_purchased | è²·ã„ç‰©ãƒªã‚¹ãƒˆã€å±¥æ­´ | å¿…é ˆ |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ´»ç”¨

```typescript
// app/components/ExpenseForm.tsx
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { createExpenseInputSchema } from "@/convex/lib/schemas";
import type { z } from "zod";

type ExpenseFormData = z.infer<typeof createExpenseInputSchema>;

export function ExpenseForm({ groupId }: { groupId: string }) {
  const createExpense = useMutation(api.expenses.create);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<ExpenseFormData>({
    resolver: zodResolver(createExpenseInputSchema),
    defaultValues: {
      splitMethod: "equal",
    },
  });

  const onSubmit = async (data: ExpenseFormData) => {
    try {
      await createExpense({ groupId, ...data });
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
      <input type="number" {...register("amount", { valueAsNumber: true })} />
      {errors.amount && <span>{errors.amount.message}</span>}
      {/* ... */}
    </form>
  );
}
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆæ¡ˆï¼‰

```
convex/
â”œâ”€â”€ _generated/          # è‡ªå‹•ç”Ÿæˆï¼ˆè§¦ã‚‰ãªã„ï¼‰
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts          # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆauthQuery, authMutationï¼‰
â”‚   â”œâ”€â”€ schemas.ts       # Zodã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚   â”œâ”€â”€ validators.ts    # Convexãƒãƒªãƒ‡ãƒ¼ã‚¿å®šç¾©
â”‚   â”œâ”€â”€ presetCategories.ts  # ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªå®šæ•°
â”‚   â””â”€â”€ helpers.ts       # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”œâ”€â”€ schema.ts            # Convexãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
â”œâ”€â”€ users.ts             # ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®mutation/query
â”œâ”€â”€ groups.ts            # ã‚°ãƒ«ãƒ¼ãƒ—é–¢é€£ã®mutation/query
â”œâ”€â”€ expenses.ts          # æ”¯å‡ºé–¢é€£ã®mutation/query
â”œâ”€â”€ categories.ts        # ã‚«ãƒ†ã‚´ãƒªé–¢é€£ã®mutation/query
â”œâ”€â”€ settlements.ts       # ç²¾ç®—é–¢é€£ã®mutation/query
â””â”€â”€ shoppingItems.ts     # è²·ã„ç‰©ãƒªã‚¹ãƒˆé–¢é€£ã®mutation/query
```

---

## ã‚„ã‚‰ãªã„ã“ã¨

### MVPå¤–ã®æ©Ÿèƒ½

| æ©Ÿèƒ½                       | ç†ç”±                            |
| -------------------------- | ------------------------------- |
| ãƒ¬ã‚·ãƒ¼ãƒˆOCR                | å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€MVPå¾Œã«æ¤œè¨   |
| é€šçŸ¥æ©Ÿèƒ½                   | PWAé€šçŸ¥ã¯è¤‡é›‘ã€MVPå¾Œã«æ¤œè¨      |
| åå…¥è¨˜éŒ²                   | æ”¯å‡ºç®¡ç†ã‚’å„ªå…ˆã€MVPå¾Œã«æ¤œè¨     |
| è²·ã„ç‰©ãƒªã‚¹ãƒˆã®å€‹åˆ¥é‡‘é¡å…¥åŠ› | åˆè¨ˆé‡‘é¡å…¥åŠ›ã§ååˆ†ã€MVPå¾Œã«æ¤œè¨ |
| ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®é€é‡‘           | ã‚¹ã‚³ãƒ¼ãƒ—å¤–                      |
| å¤šé€šè²¨å¯¾å¿œ                 | å††ã®ã¿å¯¾å¿œã€å›½éš›åŒ–ã¯MVPå¾Œ       |

### è¨­è¨ˆä¸Šã®åˆ¶é™

| é …ç›®           | åˆ¶é™å†…å®¹               | ç†ç”±                         |
| -------------- | ---------------------- | ---------------------------- |
| ã‚°ãƒ«ãƒ¼ãƒ—äººæ•°   | æœ€å¤§10äººã‚’æƒ³å®š         | ç²¾ç®—UIã®è¤‡é›‘åŒ–ã‚’é¿ã‘ã‚‹       |
| ç· ã‚æ—¥         | 1ã€œ28æ—¥ã®ã¿            | æœˆæœ«æ—¥ã¯æœˆã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ |
| éå»ã®æ”¯å‡ºç·¨é›† | ç²¾ç®—æ¸ˆã¿æœŸé–“ã¯ç·¨é›†ä¸å¯ | æ•´åˆæ€§ç¶­æŒ                   |
| æ‹›å¾…ãƒªãƒ³ã‚¯     | 1å›é™ã‚Šä½¿ç”¨            | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£                 |
| ã‚«ãƒ†ã‚´ãƒªå‰Šé™¤   | MVPã§ã¯å‰Šé™¤æ©Ÿèƒ½ãªã—    | ä½¿ç”¨ä¸­ã‚«ãƒ†ã‚´ãƒªã®æ‰±ã„ãŒè¤‡é›‘   |
| ã‚°ãƒ«ãƒ¼ãƒ—å‰Šé™¤   | MVPã§ã¯å‰Šé™¤æ©Ÿèƒ½ãªã—    | é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ãŒè¤‡é›‘       |
| ãƒ¡ãƒ³ãƒãƒ¼é€€ä¼š   | MVPã§ã¯é€€ä¼šæ©Ÿèƒ½ãªã—    | æœªç²¾ç®—æ”¯å‡ºã®æ‰±ã„ãŒè¤‡é›‘       |

---

## æ‡¸å¿µäº‹é …

### 1. ç²¾ç®—æ¸ˆã¿æ”¯å‡ºã®å–ã‚Šæ‰±ã„

**å•é¡Œ**: ç²¾ç®—æ¸ˆã¿æœŸé–“ã®æ”¯å‡ºã‚’ç·¨é›†ãƒ»å‰Šé™¤ã—ãŸå ´åˆã€ç²¾ç®—é‡‘é¡ãŒä¸æ•´åˆã«ãªã‚‹

**å¯¾å¿œæ¡ˆ**:

- Aæ¡ˆ: ç²¾ç®—æ¸ˆã¿æœŸé–“ã®æ”¯å‡ºã¯ç·¨é›†ãƒ»å‰Šé™¤ä¸å¯ï¼ˆæ¡ç”¨å€™è£œï¼‰
- Bæ¡ˆ: ç·¨é›†ãƒ»å‰Šé™¤å¯èƒ½ã ãŒã€å·®é¡ã‚’æ¬¡å›ç²¾ç®—ã«ç¹°ã‚Šè¶Šã—
- Cæ¡ˆ: ç²¾ç®—æ¸ˆã¿ã§ã‚‚æ”¯å‡ºã¯ç·¨é›†å¯èƒ½ã€ç²¾ç®—ã¯å†è¨ˆç®—ã‚’ä¿ƒã™

**æ±ºå®š**: Aæ¡ˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«å„ªå…ˆï¼‰

### 2. ã‚°ãƒ«ãƒ¼ãƒ—é€€ä¼šæ™‚ã®å‡¦ç†

**å•é¡Œ**: ãƒ¡ãƒ³ãƒãƒ¼ãŒã‚°ãƒ«ãƒ¼ãƒ—ã‚’é€€ä¼šã—ãŸå ´åˆã€æœªç²¾ç®—ã®æ”¯å‡ºã¯ã©ã†ã™ã‚‹ã‹

**å¯¾å¿œæ¡ˆ**:

- é€€ä¼šå‰ã«ç²¾ç®—ã‚’å®Œäº†ã™ã‚‹ã“ã¨ã‚’å¿…é ˆã«ã™ã‚‹
- æœªç²¾ç®—åˆ†ã¯ã€Œå…ƒãƒ¡ãƒ³ãƒãƒ¼ã€ã¨ã—ã¦è¨˜éŒ²ã‚’æ®‹ã™

**æ±ºå®š**: æœªæ±ºå®š - MVPæ™‚ç‚¹ã§ã¯é€€ä¼šæ©Ÿèƒ½ã‚’åˆ¶é™ã—ã€å¾Œã§æ¤œè¨

### 3. Convexã®ç„¡æ–™æ åˆ¶é™

**å•é¡Œ**: Convexã®ç„¡æ–™æ ï¼ˆDB 0.5GBã€é–¢æ•°100ä¸‡å›/æœˆï¼‰ã‚’è¶…ãˆã‚‹å¯èƒ½æ€§

**å¯¾å¿œ**:

- å€‹äººåˆ©ç”¨ã€œå°è¦æ¨¡ã‚°ãƒ«ãƒ¼ãƒ—ãªã‚‰å•é¡Œãªã—
- å¤§è¦æ¨¡åŒ–æ™‚ã¯æœ‰æ–™ãƒ—ãƒ©ãƒ³ã¸ç§»è¡Œ

### 4. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ

**å•é¡Œ**: Convexã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‰æã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œã¯å¤±æ•—ã™ã‚‹

**å¯¾å¿œ**:

- Phase 1ï¼ˆMVPï¼‰: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¿…é ˆ
- Phase 2: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã€å¾©å¸°æ™‚ã«åŒæœŸ

### 5. æ—¥ä»˜ã¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³

**å•é¡Œ**: æ”¯å‡ºæ—¥ä»˜ã‚’ã©ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§è§£é‡ˆã™ã‚‹ã‹

**æ±ºå®š**:

- `date`ï¼ˆæ”¯å‡ºæ—¥ï¼‰: `YYYY-MM-DD` æ–‡å­—åˆ—ã§ä¿å­˜ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›ãªã—
- `createdAt` ç­‰: UTC Unix timestamp ã§ä¿å­˜ã€è¡¨ç¤ºæ™‚ã«ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å¤‰æ›
- ç· ã‚æ—¥è¨ˆç®—: `YYYY-MM-DD` æ–‡å­—åˆ—æ¯”è¼ƒã§è¡Œã†ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œãªã—

---

## å‚è€ƒè³‡æ–™ãƒ»æƒ…å ±

### ç«¶åˆã‚¢ãƒ—ãƒª

| ã‚¢ãƒ—ãƒª    | å‚è€ƒãƒã‚¤ãƒ³ãƒˆ                   |
| --------- | ------------------------------ |
| Shareroo  | å…¨ä½“çš„ãªUXã€æ©Ÿèƒ½ã‚»ãƒƒãƒˆ         |
| Splitwise | ç²¾ç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç† |
| Warikani  | 2äººå‘ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªUI          |

### Convexå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Schemaå®šç¾©](https://docs.convex.dev/database/schemas)
- [èªè¨¼](https://docs.convex.dev/auth)
- [ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ](https://docs.convex.dev/client/react)
- [Best Practices](https://docs.convex.dev/understanding/best-practices/) - å…¬å¼ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### Convex + Zod é€£æº

- [Zod with TypeScript for Server-side Validation](https://stack.convex.dev/typescript-zod-function-validation) - zCustomQuery/zCustomMutationã®ä½¿ã„æ–¹
- [Zod Validation: Wrappers as "Middleware"](https://stack.convex.dev/wrappers-as-middleware-zod-validation) - withZodãƒ©ãƒƒãƒ‘ãƒ¼ã®å®Ÿè£…
- [convex-helpers Validation Tools](https://deepwiki.com/get-convex/convex-helpers/4-validation-tools) - å„ç¨®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã®è§£èª¬

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- [Convex Project Building Guidelines](https://gist.github.com/srizvi/966e583693271d874bf65c2a95466339) - ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã€ã‚¯ã‚¨ãƒªã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### å‚è€ƒè¨˜äº‹

- [Splitwise algorithm](https://medium.com/@mithunmk93/algorithm-behind-splitwises-debt-simplification-feature-8ac485e97688) - ç²¾ç®—ã®æœ€å°åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. [ ] ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª
2. [ ] èªè¨¼æ–¹å¼æ±ºå®šï¼ˆClerk vs Convex Authï¼‰
3. [ ] `convex/schema.ts` ã®å®Ÿè£…
4. [ ] ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªã®ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ä½œæˆ
5. [ ] åŸºæœ¬çš„ãªCRUD mutationã®å®Ÿè£…

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜       | å¤‰æ›´å†…å®¹                                                                                                                     | å¤‰æ›´è€… |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------- | ------ |
| 2024-12-30 | åˆç‰ˆä½œæˆ                                                                                                                     | Claude |
| 2024-12-30 | ãƒ¬ãƒ“ãƒ¥ãƒ¼åæ˜ : æŠ€è¡“ä»•æ§˜è¿½åŠ ï¼ˆConvex IDã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼‰ã€splitMethodèª¬æ˜æ˜ç¢ºåŒ–ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«è¿½åŠ ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒªæ–¹å¼å¤‰æ›´ | Claude |
| 2024-12-30 | Settlementè‡ªå‹•å®Œäº†ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ ã€èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ–¹å¼ã«å¤‰æ›´                                                                   | Claude |
